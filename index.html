<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>City Map</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-awesome-markers/2.0.2/leaflet.awesome-markers.css" />
</head>
<body>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		#map {
			margin-top: 20px;
			border: 1px solid #ccc;
			border-radius: 8px;
		}
	</style>
	<div id="map" style="height: 800px; width: 100%;"></div>
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-awesome-markers/2.0.2/leaflet.awesome-markers.min.js"></script>
	<script>
	// Инициализация карты (используем OpenStreetMap)
	let map = L.map('map').setView([53.1959, 45.0183], 5); // Начальные координаты

	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	  attribution: '© OpenStreetMap contributors'
	}).addTo(map);
	
	map.attributionControl.setPrefix(false)
	
	const greenIcon = L.AwesomeMarkers.icon({
		icon: 'circle',
		markerColor: 'green',
		prefix: 'fa',
	});
	const grayIcon = L.AwesomeMarkers.icon({
		icon: 'circle',
		markerColor: 'gray',
		prefix: 'fa',
	});

	// Загрузка данных с сервера
	async function loadCities() {
	  try {
		const response = await fetch('https://raw.githubusercontent.com/aleasweb/tgMap/main/cities.json');
		const data = await response.json();

		if (data.list && data.visited) {
		  data.cities.forEach(city => {
			const { name, lat, lng } = city;
			L.marker([lat, lng], { icon: greenIcon }).addTo(map)
			  .bindPopup(name); // Добавляем маркер с названием города
		  });
		}
		
		if (data.list && data.notvisited) {
		  data.cities.forEach(city => {
			const { name, lat, lng } = city;
			L.marker([lat, lng], { icon: grayIcon }).addTo(map)
			  .bindPopup(name); // Добавляем маркер с названием города
		  });
		}
	  } catch (error) {
		console.error('Ошибка при загрузке данных:', error);
	  }
	}

	// Инициализация Telegram Web App
	Telegram.WebApp.ready();
	Telegram.WebApp.expand(); // Развернуть приложение на весь экран

	// Загружаем города при запуске
	loadCities();
	</script>
</body>
</html>